Troubleshooting
=====

Toubleshooting why users don't receive emails requires to follow emails at many layers. Emails are generated by the rails app, stored in redis and sent actioned a sidekiq worker. Actionmailer is used to send the email and openssl is used if TLS is enabled to communicate with your SMTP provider. 
The provider reveiving mastodon emails will likely do checks to understand if your emails are legitimate or not.

### Troubleshooting emails
This document describe the component involved inside mastodon: the logic in the rails apps, Redis,actionmailer, the sidekiq worker and how they interact with the SMTP:
It also trie to help troubleshooting the receiving of your emails. 
- [Understanding the components involved in Mastodon](README.md#email_flow)
- [Troubleshooting emails in mastodon](README.md#emails_inside_mastodon)
- [Troubleshooting emails outside of mastodon](README#emails_outside_mastodon)

### Email Flow


### Email inside mastodon
Working from the outside in, you will start by looking at the worker queue.
You can look at the sidekiq logs from docker like so:
`docker logs -f mastodon_sidekiq_1`
You can look at the sidekiq console: https://yourmastodon.instance/sidekiq

### Email outide mastodon
You might want to check that your SMTP serivce supports STARTTLS or authentiction.
You can test authentication support:
You can test starttls with `openssl` like so:
`openssl s_client -starttls smtp -crlf -connect example.com:587`
You might also want to check what version and cipher they support in a more readbale format with a third party service like `https://tls.imirhil.fr/`.
